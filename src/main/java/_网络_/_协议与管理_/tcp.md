

TCP/IP
传输控制协议 因特网互联协议
协议栈 （协议集合）

TCP/IP 分层

    应用层
    传输层
    互联网层
    网络接口层（物理 + 数据链路）
    
    对应OSI 7层模型
    
    TCP 应用层 协议 （ftp tftp nfs emtp snm 。。。。 nginx 阿帕奇 等应用 层 协议 ）
    
    
TCP/IP 和OSI 

    相同点：
        以协议栈为基础
        协议独立
        下层对上层提供服务
    
    不同：
        OSI 现有模型 后又协议
        TCP /IP 相反
        OSI是标准
        TCP 是 只用域 TCP/IP
        
        
TCP / UDP （ 传输层 协议）

    TCP                UDP
    可靠               高效
    (保证数据 是否 送到) （不用确认 ，我只发送 ， 速度快）
    面向连接           非 面向
    有次序             无次序
    （文件 邮件 下载） （语音 视频）
    
    
传输层
TCP 头格式

    4 + 4 + 4 + 4 + 12个 填充
    
    源端口 目标端口 （标识 应用）
        端口规则：
            0 - 1023 特权端口 只有管理员可以使用
            永久的给固定 系统应用适应
            
            1024-49151 用户端口 你自己用
            
            49151 - 65535 动态 或私有 客户端随机使用
            
    序号  
        标识 数据包序号 第几个第几个
        
    确认号
        确认收到 标号
        
    数据偏移 保留 [URG ACK RST SYN(连接) FIN(分手)] 窗口    
        头长（4字节 还可加 40个字节 可变长度 头）  保留不用  [六个标记位 标识 当前 工作状态 ， TCP连接 标识]
        窗口： 就是 发送多少个之后 才确认是连接
        
        
    校验和  紧急指针
        传输相关
    
    选项（长度不固定） + 填充
   
    
    
TCP 面向 连接

建立连接

    三次握手
        SYC-SENDT发送 SUN =1 SEQ = X
        SUN-RCVD接受发送 SYN =1 ACk = 1 SEQ = Y ack = X+1
        SYC-SENDT接受发送 ACK = 1 SEQ = X+1 ack = Y+1
        ESTAB-LISHED建立连接        
        
    四次挥手
        C:主动关闭FIN = 1 SEQ = 1 等待 回应
        S:收到请求 ACK = 1 SEQ = v ack  = u + 1 // 收到 分手请求 close-wait
        S:等待结束 回送关闭 FIN = 1 ACK = 1 SEQ = w ack = u + 1
        (半关闭)
        C:等待结束 回送关闭 ACK = 1 SEQ = u ack = w + 1
        
        
    sync 半连接队列
        未完成连接 ， 处于 准备处理中，放到一个队列里面，等待处理 ， 一般大小128
    accept 全连接队列
        完成连接 ，处理 完成请求放到一个队列，下一步执行 ， 一一般大小128 
      
        // 建议 大小 1024
        
        // 一般攻击 有的 就是 可能 将 队列沾满 导致 服务器 瘫痪
        
        
UDP 非面向协议

    不可靠的网络连接 (错误包 就丢弃了)
    有限错误检测
    性能高
    没有数据回复啥的
    
    单个包大小不能超过65535 （0-65535）
    
    
Internet 层 （IP协议 ICMP ARP RARP 等协议）

    ICMP 协议 
        确认网络是否连通
        比如 PING 命令 ， 用的 就是 ICMP 协议
        
        tracrt 探测 倒达到 目标 ip 经过的路由器数量 // 禁用ICMP协议 会先显示成 *
        
        // ping 攻击 ping -f IP  // 不停的 发送不用去接收是否收到
        // ping -s 65507 -f IP // 最大 65507
        
        // 达到 攻击 网路 使对方 网络带宽瘫痪
        
        
    ARP 协议
        地址解析协议
        将ip地址 解析为物理地址
        // 
        // 你是 怎么 去找到 被人的？？
        //
        ARP 通过广播 的形式 去发送数据报文 寻找 目标
        // 如果 到达么目标 
        // 目标就会交 MAC 告诉 ARP 
        // ARP 就会 缓存 起来 下次 连接 的时候 就不用去 广播寻找了 // 相应也就快了
        // 缓存
        
        确认机制？
        对方回送的MAC地址 可能不是 你的期望MAC
        // 
        ARP 没有 确认机制
        //
        很容易发生安全问题
        被窃取 监听啥的
        
        即ARP 欺骗
        
    Gratuitous ARP
    免费ARP ，无故ARP 
    作用：
        向网络中 发送garp请求 请求 自己得IP与MAC 要是 都没有 就证明 这个 IP 是俺可以用的 // 验证IP 是否冲突
        //  没人用之后 自己给自己发一个。。哈哈 自问自答
        更换物理网卡： 要是你更换了 物理网卡 ， 就告诉别人 更新你的MAC
        
        
        
    RARP 协议
        将MAC转换为IP
        
        比如网吧
        // 网吧电脑很多是无硬盘的
        // 开机启动时 会先启动mac 然后 把自己的mac 发送给 服务器
        // 服务器 去他的表中查找对应的 ip ， 
        // 然后 集器就可以上网了 ， 然后 连接 加载 下载 配置 啥信息
        // 这些东西 都是 在服务器上的
        // 所以 对 网络要求 高
        // 
        
        
    internet 协议
        运行 OSI 网络层
        面向无连接协议
        独立处理数据包
        分层编址
        尽力传输
        无数据恢复功能
        
        
        IP 协议
         
            PDU数据报文头
            
            固定部分
                版本 4
                    IPV4 IPV6
                首部长度 4
                    约定头部长度
                区分服务 8
                    区分不同网络服务
                总长度 16
                    全部长度
                标识  8
                    标识切出来的包 ， 一个大包切出来  在标记为标识
                标志  3
                    第一位不用， 使用 后两位
                    DF DF = 0 时允许分片
                    MF MF = 1 表示 继续分片 MF = 0时 表示 最后一个分片
                片偏移 13
                    表示是 大包的第几个包 // 偏移
                生存时间 8
                    就是经过路由器的数量 要是太多了 ，过期 丢掉 （最大255） win 默认 128
                    ping 的时候 后面的 TTL 就是 经过之后留下来的数量
                协议    8
                    上层/下层协议 标记
                首部校验和 16
                    验证上面的信息是否被改动
                源地址     32
                目标地址    32
                
            可变部分
                填充字段
                可选字段
            数据部分
        
        
连接过程

    主机发送 连接请求（application） （可靠连接）        
    transport 可靠连接 使用TCP 
    和对方建议会话 （握手）
    握手（ARP 缓存 或者 广播 得到对方MAC）
    得到地址
    数据报文 全了
    然后加上 TCP SYN 同步消息头
    握手连接
    // 
    
    
        

    
    
    


        
    
    
    
    
    
    